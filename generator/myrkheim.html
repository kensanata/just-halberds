<!DOCTYPE html>
<html lang="en"> <!-- Change this for hyphenation in other languages! -->
<head>
<meta charset="utf-8">
<title>Myrkheim</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
@media screen {
    body {
        background: #000;
        color: #dfd;
        margin-left: clamp(1ex, 5%, 4em);
    }
    #noprint hr {
        background: green;
        border: 0;
        height: 1px;
        margin: 0.25em 0em 1.5em -10em;
    }
    blockquote {
        margin-left: 0;
        padding-left: 1ex;
        border-left: 0.5ex solid #cdcd00;
    }
    line, circle {
        stroke: chartreuse;
        stroke-width: 1.25pt;
    }

    text {
        fill: chartreuse;
        text-anchor: middle;
        dominant-baseline: central;
        font-size: 8pt;
    }
    circle {
         fill: black;
    }
    a {
        color: chartreuse;
        text-decoration: none;
    }
    a:visited {
        color: green;
    }
    a:hover {
        text-decoration: underline;
    }
    address ul {
        display: block;
        padding: 0;
    }
    address li {
        display: inline;
    }
    address li:first-child::before {
        content: "Authors: ";
    }
    address li::before {
        content: ", ";
    }
}
@media print {
    body {
        background: #fff;
        color: #000;
        font-size: 10pt;
    }
    #Z, svg {
        display: none;
    }
    #noprint {
        display: none;
    }
    h2 {
        break-after: avoid;
    }
    p {
        break-inside: avoid;
    }
    blockquote {
        break-inside: avoid;
    }
    a, a:visited {
        color: #000;
        font-style: italic;
        text-decoration: none;
    }
    address ul {
        padding-left: 0;
        list-style-type: none;
    }
    address a::after {
        content: " <" attr(href) ">";
    }
    table#encounters th:first-child + th + th {
        display: none;
    }
    table#encounters td {
        vertical-align: top;
    }
    table#encounters td:first-child + td,
    table#encounters td:first-child + td + td {
        display: inline;
    }
    table#encounters td:first-child + td {
        margin-right: 1ex;
    }
    table#encounters td:first-child + td + td::before {
        content: "​("; /* ZERO WIDTH SPACE */
    }
    table#encounters td:first-child + td + td::after {
        content: ")";
    }
}
body {
    font-family: "Iosevka Etoile", Iosevka, "Dejavu Sans Mono", Inconsolata, Monaco, Courier, monospace;
    font-size: 12pt;
    margin: 1em;
    hyphens: auto;
}
#links {
    padding: 0;
    font-size: smaller;
}
#links li {
    display: inline;
}
#target, #documentation {
    max-width: 800px;
}
.example {
    white-space: pre-wrap;
    color: #8fd;
}
.result {
    white-space: normal;
}
.invisible {
    display: none;
}
table {
    margin-top: 1ch;
    border-collapse: collapse;
    width: 100%;
}
.c {
    text-align: center;
    min-width: 2em;
}
</style>

<script>
function parse(data) {
  // This is the return of parse().
  let h = {};

  // Save the data so that h can be reused in multiple calls to generate().
  h.tables = transform(data);

  // Generate text. This function is accessible from the outside.
  // If start is empty, h.start is used which defaults to the first table.
  h.generate = function(start) {
    h.names = {}; // reset
    return pick(start || h.start);
  };

  // Read data and parse comments, table names and weighted rows.
  function transform(data) {
    let table = {};
    let rows;
    data.split("\n").forEach(row => {
      let m;
      if (row.match(/^\s*#/)) { /* Comments */ }
      else if (row.startsWith(";")) { rows = []; table[row.substring(1)] = rows; h.start ||= row.substring(1); }
      else if ((m = row.match(/^(\d+),(.*)/))) { rows.push([m[2], Number(m[1])]); }
      else if (row.match(/\S/)) { rows[rows.length - 1][0] += row; } // append
    });
    return table;
  }

  // Save the results of the last call
  h.results = {};

  // The list of names ensures that generated names are unique
  h.names;

  // Do replacements when you return
  h.replacements = [];

  // Recursively pick items from tables and process the string
  function pick(table, level) {
    if (level == undefined) {
      level = 1;
      h.results = {};
    } else if (level > 20) {
      if (table.endsWith(" name")) {
        console.log(`Tried to get a unique name from ${table} for 20 times and failed`);
      } else {
        console.log(`Recursion deeper than 20 for ${table}`);
      }
      beep();
      return "…";
    }
    // pick an appropriate item
    let text = weighted_pick(table);
    // look for search and replace suffixes like /a/b/ (this only
    // works for levels > 1)
    const m = text.match(/\/([^\/]+)\/([^\/]*)\/$/);
    // Short by the search & replace pattern, if any.
    if (m) {
      text = text.substring(0, text.length - m[0].length);
      h.replacements.push(m);
    }
    let i = text.indexOf("[");
    while (i >= 0) {
      let s = text.substring(i);
      let m;
      let ok = false;
      if (m = s.match(/^\[(\d+)d(\d+)(?:([+-]\d+))?\]/)) {
        // [2d6] rolls dice
        text = text.substring(0, i)
          + roll(Number(m[1]), Number(m[2]), m[3] ? Number(m[3]) : 0)
          + s.substring(m[0].length);
        ok = true;
      } else if (m = s.match(/^\[([^\[\]]+)\+\+@([^\[\]]+)\]/)) {
        // [a++@b] increments value of key a in map b
        text = text.substring(0, i)
          + s.substring(m[0].length);
        h.results[m[2]] ||= {};
        h.results[m[2]][m[1]] ||= 0;
        h.results[m[2]][m[1]]++;
        ok = true;
      } else if (m = s.match(/^\[~([^\[\]]+)\]/)) {
        // [~b] reset map or list b
        text = text.substring(0, i)
          + s.substring(m[0].length);
        delete h.results[m[1]];
        ok = true;
      } else if (m = s.match(/^\[([^\[\]]+)@@([^\[\]]+)\]/)) {
        // [a@@b] appends a to list b
        text = text.substring(0, i)
          + s.substring(m[0].length);
        h.results[m[2]] ||= [];
        h.results[m[2]].push(m[1]);
        ok = true;
      } else if (m = s.match(/^\[([^\[\]]+)@([^\[\]]+)\]/)) {
        // [a@b] saves a as b
        text = text.substring(0, i)
          + s.substring(m[0].length);
        h.results[m[2]] = m[1];
        ok = true;
      } else if (m = s.match(/^\[@\+\+([^\[\]]+)\]/)) {
        // [@b++] returns the key with the highest value in map b
        let v = h.results[m[1]];
        text = text.substring(0, i)
          + shuffle(Object.keys(v)).reduce((ac, cur) => v[ac] > v[cur] ? ac : cur, 0)
          + s.substring(m[0].length);
        ok = true;
      } else if (m = s.match(/^\[([^\[\]]+\|[^\[\]]+)\]/)) {
        // [a|b] choose a or b
        text = text.substring(0, i)
          + one(m[1].split('|'))
          + s.substring(m[0].length);
        ok = true;
      } else if (m = s.match(/^\[([^\[\]]+)\?([^\[\]]*):([^\[\]]*)\]/)) {
        // [x?a:b] choose a or b depending on whether x is true or false
        text = text.substring(0, i)
          + (eval(m[1]) ? m[2] : m[3])
          + s.substring(m[0].length);
        ok = true;
      } else if (m = s.match(/^\[([^@\[\]]+)\]/)) {
        // [a] pick an entry from table 'a'
        let p = pick(m[1], level + 1);
        text = text.substring(0, i)
          + p
          + s.substring(m[0].length);
        h.replacements.forEach((r) => text = text.replace(new RegExp(r[1], r[3]), r[2]));
        h.replacements = [];
        ok = true;
      } else if (m = s.match(/^\[@([^\[\]]+)\]/)) {
        // [@b] use variable b
        let v = h.results[m[1]];
        if (v === undefined) { console.log(`No stored value for ${m[1]} in ${table}`); v = "…"; }
        else if (Array.isArray(v)) { v = v.join(", "); }
        else if (v === Object(v)) { v = Object.keys(v).sort().map(k => k + "-" + v[k]).join(", "); }
        text = text.substring(0, i)
          + v
          + s.substring(m[0].length);
        ok = true;
      } else {
        // We did not make a replacement, advance to the next one.
        let n = s.substring(1).indexOf("[");
        if (n >= 0) {
          i = i + 1 + n;
          continue;
        }
      }
      // We made a replacement, start over.
      if (ok) {
        i = text.indexOf("[");
        continue;
      }
      // We didn't do a replacement, and we didn't find another
      // square bracket to look at, so we're done.
      break;
    }

    // Retry duplicates
    if (table.endsWith(" name")) {
      let key = `${table}: ${text}`;
      if (h.names[key]) {
        // console.log(`Seen ${key} before`);
        text = pick(table, level + 1);
      } else {
        // console.log(`Seen ${key} for the first time`);
        h.names[key] = true;
      }
    }

    // Save
    h.results[table] = text;

    if (level === 1) {
      // emphasis
      text = text.replaceAll(/\*\*(.*?)\*\*/g, (m, a) => { return `<strong>${a}</strong>` });
      text = text.replaceAll(/\*(.*?)\*/g, (m, a) => { return `<em>${a}</em>` });
    }
    return text;
  }

  // Pick an item from the table,
  function weighted_pick(table) {

    const t = h.tables[table];
    if (!t) { console.log(`There is no table ${table}`); return "…"; }
    const total = t.reduce((n, x) => n + x[1], 0);
    // start with 1
    const n = Math.floor(Math.random() * total) + 1;
    let i = 0;
    for (const z of t) {
      i += z[1];
      if (i >= n) return z[0];
    }
    console.log(`The table ${table} has no result for ${n}`);
    return "…";
  }

  function shuffle(a) {
    for(let i = a.length - 1; i > 0; i--){
      const j = Math.floor(Math.random() * (i + 1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  }

  // Return a random element from arr.
  function one(arr) {
    return arr[Math.floor(Math.random() * arr.length)];
  }

  // Roll dice.
  function roll(num, sides = 6, plus = 0) {
    let total = 0;
    for (let i = 0; i < num; i++) {
      total += Math.floor(Math.random() * sides + 1);
    }
    return total + plus;
  }

  // To do anything, call generate().
  return h;
}

function create_map(svg) {
  if (!svg) return;
  let svgNs = 'http://www.w3.org/2000/svg';
  let mx = 400;
  let my = 200;
  let mr = 50;
  // compute all the points
  let points = [];
  for (let ring = 1; ring <= 2; ring++) {
    for (let i = 0; i < 6 * ring; i++) {
      points.push({x: mx + mr * ring * Math.sin(i * Math.PI / 3 / ring),
                     y: my + mr * ring * Math.cos(i * Math.PI / 3 / ring)});
    }
  }
  for (let i = 0; i < 6; i++) {
    points.push({x: mx + mr * 3 * Math.sin((i + 0.5) * Math.PI / 3),
                 y: my + mr * 3 * Math.cos((i + 0.5) * Math.PI / 3)});
  }
  // draw a line using SVG
  let f = (x1, y1, x2, y2) => {
    let l = svg.ownerDocument.createElementNS(svgNs, 'line');
    l.setAttribute('x1', x1);
    l.setAttribute('y1', y1);
    l.setAttribute('x2', x2);
    l.setAttribute('y2', y2);
    svg.appendChild(l);
  };
  // inner ring
  for (let last = points[5], p = points[0], i = 0; i < 6; last = p, p = points[++i]) {
    f(last.x, last.y, p.x, p.y);
  }
  // outer ring
  for (let last = points[17], p = points[6], i = 6; i < 18; last = p, p = points[++i]) {
    f(last.x, last.y, p.x, p.y);
  }
  // inner spokes
  for (let i = 0, p1 = points[0], p2 = points[6]; i < 6; i++, p1 = points[i], p2 = points[6 + 2*i]) {
    f(p1.x, p1.y, p2.x, p2.y);
  }
  // outer spokes
  for (let i = 0, p1 = points[7], p2 = points[18]; i < 6; i++, p1 = points[7+2*i], p2 = points[18 + i]) {
    f(p1.x, p1.y, p2.x, p2.y);
  }
  // draw a circle using SVG
  f = (cx, cy, i) => {
    let code = String.fromCharCode(65 + i);
    let a = svg.ownerDocument.createElementNS(svgNs, 'a');
    a.setAttribute('href', '#' + code);
    svg.appendChild(a);
    let c = svg.ownerDocument.createElementNS(svgNs, 'circle');
    c.setAttribute('cx', cx);
    c.setAttribute('cy', cy);
    c.setAttribute('r', '10');
    a.appendChild(c);
    let t = svg.ownerDocument.createElementNS(svgNs, 'text');
    t.setAttribute('x', cx);
    t.setAttribute('y', cy);
    t.textContent = code;
    a.appendChild(t);
  };
  // circles
  for (let i = 0; i < points.length; i++) { f(points[i].x, points[i].y, i) };
}

function beep() {
  var context = new AudioContext();
  var oscillator = context.createOscillator();
  oscillator.type = "sine";
  oscillator.frequency.value = 100;
  oscillator.connect(context.destination);
  oscillator.start();
  setTimeout(function () {
      oscillator.stop();
  }, 100);
}

function slug(s) {
  return s.replaceAll(/['"-']+/g, "-").toLowerCase();
}

function menu(data) {
  let html = "<ul>\n";
  data.split("\n").forEach(row => {
    if (row.startsWith(";")) {
      let t = row.substring(1);
      html += `<li><a href="javascript:show('${slug(t)}')">${t}</a>\n`;
    }
  });
  return html;
}

function linked(data) {
  data = data.replaceAll("<", "&lt;");
  data = data.replaceAll(">", "&gt;");
  data = data.replaceAll(/^;(.*)/mg,
                         (m, t) => { return `<p>;<a id="${slug(t)}" href="javascript:show('${slug(t)}')">${t}</a>` });
  data = data.replaceAll(/\[([^@\[\]\|]+)\]/g,
                         (m, t) => {
                           if (m.match(/^\[\d+d\d+(?:\+\d+)?\]$/)) return m;
                           if (m.match(/\?.*:/)) return m;
                           return `[<a href="#${slug(t)}">${t}</a>]` });
  data = data.replaceAll(/\*\*(.*?)\*\*/g, (m, a) => { return `<strong>${a}</strong>` });
  data = data.replaceAll(/\*(.*?)\*/g, (m, a) => { return `<em>${a}</em>` });
  data = data.replaceAll(/\n+#/g, "<p>");
  data = data.replaceAll(/\n+/g, "<br>");
  return data;
}

function show(t) {
  generate((data) => parse(data).generate(t)
  + `<p><button type="button" onclick="show('${t}')" title="Reload">🔁</button>`);
}

function generate(f) {
  document.getElementById('target').setAttribute('class', 'visible');
  document.getElementById('documentation').setAttribute('class', 'invisible');
  const data = document.getElementById('data').textContent;
  let html = f(data);
  if (window.location.search) {
    for (let i = 0; i < 50; i++) {
      if (html.match(window.location.search.substr(1))) {
        break;
      }
      html = f(data);
    }
  }
  document.getElementById('target').innerHTML = html;
  create_map(document.getElementById('map'));
}

function example () {
  const data = event.target.parentElement.firstChild.textContent;
  let html = parse(data).generate();
  if (event.target.nextElementSibling) {
    event.target.nextElementSibling.innerHTML = html;
  } else {
    const target = event.target.ownerDocument.createElement('blockquote');
    target.setAttribute("class", "result");
    target.innerHTML = html;
    event.target.parentNode.appendChild(target);
  }
}

function documentation () {
  document.getElementById('target').setAttribute('class', 'invisible');
  document.getElementById('documentation').setAttribute('class', 'visible');
}
</script>
</head>
<body>

<h1>Myrkheim</h1>
<div id="noprint">
  <button type="button" onclick="generate((data) => parse(data).generate('start'))">Generate</button>
  <button type="button" onclick="generate((data) => menu(data))">List tables</button>
  <button type="button" onclick="generate((data) => linked(data))">Show tables</button>
  <button type="button" onclick="documentation()">Help</button>
  <ul id="links">
    <li><a href="https://alexschroeder.ch/pdfs/Knives.pdf">Knives</a>
    <li><a href="https://alexschroeder.ch/pdfs/Halberts.pdf">Halberts</a>
    <li><a href="https://alexschroeder.ch/wiki/Contact">Alex Schroeder</a>
    <li><a href="https://creativecommons.org/publicdomain/zero/1.0/">CC0 1.0</a>
  </ul>
  <hr>
</div>

<div id="target"><p>This is a stand-alone generator. You can save the HTML file locally and it will continue to work. Feel free to use examine, change and distribute it elsewhere. No strings attached. It is dedicated to the public domain.
<p>You can replace all the tables in this file with your own and make your own generators! Please do.
</div>
<div class="invisible" id="documentation"><p>Save this page and open it in a text editor. Make a change, save the file, open it in the browser and check whether it worked. My suggestion is to start with something easy. Maybe you noticed a weird name like “Nadû the Gardener”. Search this file for that name, remove all the names in the list and provide your own.
<h2>The table format</h2>
<p>Lines beginning with optional whitespace and a <strong>#</strong> are comments.
<p>A line starting with a semicolon like <strong>;some words</strong> begins a table called “some words”.
There is no space after the semicolon.
<p>A number and a comma like <strong>1,some words</strong>begin a weighted entry for the current table.
<p>Here is an example table called “realm”. The three realms have equal chances for coming up (each has a 1 in 3 chance).
<div class="example"># some norse realms
;realm
1,Muspelheim
1,Jötunheim
1,Vanaheim
<button type="button" onclick="example()">Try it</button>
</div>
<p>In the following table, Midgard is twice as likely as the other realms. Or in other words, Midgard has a 2 in 5 chance for coming up and the other realms have a 1 in 5 chance for coming up.
<div class="example">;realm
1,Muspelheim
1,Jötunheim
1,Vanaheim
2,Midgard
<button type="button" onclick="example()">Try it</button>
</div>
<p>A text in square brackets with options separated by a vertical bar like <strong>[Muspelheim|Jötunheim|Vanaheim]</strong> gets replaced with one of the options. This is a shortcut so you don’t have to write separate small tables. The example given is equivalent to the first “realm” table above. All options have an equal chance for coming up.
<div class="example">;realm
1,[Muspelheim|Jötunheim|Vanaheim]
<button type="button" onclick="example()">Try it</button>
</div>
<p>Single asterisks like <strong>*some words*</strong> render the text in italics for emphasis.
<p>Double asterisks like <strong>**some words**</strong> render the text in bold for strong emphasis.
<p>Lines that don’t start with a semicolon (beginning a table) or a number and a comma (beginning a weighted entry for the current table) are appended to the current entry. Begin each line with a space if you need one, because newlines are stripped. Newlines are not replaced by a space! Use HTML like <strong>&lt;p&gt;</strong> for new paragraphs or <strong>&lt;br&gt;</strong> for line breaks.
<div class="example">;travel
1,This is **Yggdrasil**, the world tree.
&lt;p&gt;They say that the dragon *Níđhöggr* gnaws at its roots.
1,This is **Yggdrasil**, the world tree.
&lt;p&gt;They say that it’s branches connect all the realms.
<button type="button" onclick="example()">Try it</button>
</div>
<p>A text in square brackets like <strong>[some words]</strong> gets replaced with a lookup of table “some words”.
<p>If a table ends with “ name” then the result is unique. Be sure to use this only for tables that produce enough results!
<div class="example"># notice the continuation on the next line
# and the space at the beginning of the next line
;passage to another realm
1,This is a passage to Hades.
 It is guarded by [guardian name], [guardian name] and [guardian name].

;guardian name
1,the gorgon [Stheno|Euryale|Medusa]
1,the hero [Heracles|Perseus|Bellerophon|Orion]
1,the hero [Asclepius|Aristaeus|Jason|Achilles|Odysseus|Hector]
1,the bronze giant Talos
<button type="button" onclick="example()">Try it</button>
</div>
<p>A limited form of dice roll notation is recognised and replaced by such a dice roll, e.g. <strong>[2d6]</strong> or <strong>[1d6+3]</strong>.
<p>Results can be stored in a variable by using the @ sign inside square brackets. The text before the @ sign is stored in the variable named after @ sign. <strong>[[guardian name]@name]</strong> stores a guardian name from the table above in the variable “name”. This assignment itself does not produce any text.
<p>To insert the value of a variable, start the text inside square brackets with the @ sign. <strong>[@name]</strong> inserts the value stored in the variable “name”.
<p>In the following example, the human name is generated once and used twice:
<div class="example">;humans
1,[[human name]@name][@name], human:
 Strength-[2d6] Dexterity-[2d6] Endurance-[2d6] Intelligence-[2d6] Education-[2d6] Status-[2d6]
 [Craft|First Aid|Oratory]-[1d2] Singing-[1d2+1] [Climbing|Running]-[1d2]
&lt;p&gt;[@name] will only help people who can sing along.

;human name
1,Ada
1,Ageric
1,Agnes
1,Alard
1,Alaric
1,Alice
<button type="button" onclick="example()">Try it</button>
</div>
<p>And finally, there are some advanced features that you hardly ever need unless you’re writing a character creator or something fancy like it.
<p>You can treat a variable like a list and add terms to it. In that case, use @@ instead of @. <strong>[[event]@@history]</strong> looks up an entry in the “event” table and appends it to the variable “history”. When using the variable, it gets replaced by a comma-separated list of entries: <strong>[@history]</strong>.
<div class="example">;backstory
1,“I have been through a lot:
[[event name]@@history]
[[event name]@@history]
[[event name]@@history]
[[event name]@@history]
 [@history]. I’ve had enough.”

# unique results because it ends with “name”
;event name
1,the [Vampire|Lizard|Wight] Wars
1,the [Pinega|Yomtsa|Vaga|Uftyuga|Vychegda|Yug|Sukhona] Uprising
<button type="button" onclick="example()">Try it</button>
</div>
<p>You can use a variable to count things. Use ++@ instead of @ to do this. <strong>[[talent]@@talents]</strong> looks up an entry in the “talent” table and count it in the “talents” table. When using the variable, it gets replaced by a comma-separated list of entries with the counts: <strong>[@talents]</strong>.
<p>If you just want the thing with the highest number for a counter variable, use @++ instead of @ to do this: <strong>[@++talents]</strong>.
<p>If you use list and counter variables to create a character, for example, each character needs a new set of talents. Use ~ to reset a variable: <strong>[~talents]</strong>.
<div class="example">;party
1,Alice: [human]
&lt;p&gt;Ada: [human]

;human
1,Strength-[2d6], Dexterity-[2d6], Endurance-[2d6], Intelligence-[2d6], Education-[2d6], Status-[2d6],
[~talents][[talent]++@talents][[talent]++@talents][[talent]++@talents][[talent]++@talents][[talent]++@talents]
 [@talents]. Favourite: [@++talents].

;talent
1,Craft
1,First Aid
1,Oratory
1,Singing
1,Climbing
1,Running
<button type="button" onclick="example()">Try it</button>
</div>
<p>And finally, in some very simple cases, you can evaluate an expression as Javascript in order to pick one of two options:
<strong>[x?a:b]</strong>. If x is "true" it is replaced with a else with b.
<h2>Tricks</h2>
<p>You can use rules to generate table names. In the following example, the variable “realm” holds either “Muspelheim” or “Jötunheim” and is then used to get the appropriate monsters and an appropriate description.
<pre class="example">
;story
1,The song is called “The glory of [[realm]@realm][@realm]”.
 The local [[@realm] monsters] are terrifying.
 [[@realm] description]

;realm
1,Muspelheim
1,Jötunheim

;Muspelheim monsters
1,fire giants

;Muspelheim description
1,Everything is on fire!

;Jötunheim monsters
1,ice giants

;Jötunheim description
1,Everything is frozen!
<button type="button" onclick="example()">Try it</button>
</pre>
<h2>Troubleshooting</h2>
<p>The <strong>[x?a:b]</strong> construct is tricky. You might think of it as “pick a <em>or</em> b”, but a more accurate description would be: “expand <em>both</em> a and b, and then pick”. This is important if the expansion of a or b involves the setting of variables. In the following example, first the die is rolled, then both “fire salamander” and “ice salamander” are expanded (and the variable “element” is first set to “fire” and then set to “ice”!) and then the die roll is compared with 3 and the appropriate expansion is picked. The salamanders are red or blue. But no matter what colour they have, the always rule a world of ice. 😔
<pre class="example">
;salamander
1,[[1d6] <= 3?[fire salamander]:[ice salamander]]
 They rule a world of [@element].

;fire salamander
1,Red salamanders![fire@element]

;ice salamander
1,White salamanders![ice@element]
<button type="button" onclick="example()">Try it</button>
</pre>
<p>One way to rewrite this would be to set the element first and <em>then</em> use indirection.
<pre class="example">
;salamander
1,[[[1d6] <= 3?fire:ice]@element]
[[@element] salamander]
 They rule a world of [@element].

;fire salamander
1,Red salamanders!

;ice salamander
1,White salamanders!
<button type="button" onclick="example()">Try it</button>
</pre>
<h2>Testing</h2>
<p>When opening the file in your browser, you can force the generator to try very hard to generate a passage you’re interested in. By appending “<a href="?moth">?moth</a>” and clicking the “Generate” button, the generator generates up to 20 settings, looking for the word “moth” (a case-sensitive regular expression).
<footer>
<address>
<ul>
<li><a href="https://alexschroeder.ch/">Alex Schroeder</a>
</ul>
</address>
</footer>
</div>
<!-- The script tag with the unknown type means that it won’t get executed and no HTML escaping is required! -->
<script id="data" type="text/x-generator">;start
1,[initial setup]
[map setup][svg map]
[tunnels random encounters]
[map description]
<hr>
[footer]

;footer
1,<footer>
<address>
<ul>
<li><a href="https://alexschroeder.ch/">Alex Schroeder</a>
<li><a href="https://www.whidou.fr/">Whidou</a>
</ul>
</address>
</footer>

;initial setup
1,<p>Myrkheim is a realm of darkness.
 If you can find <a href="#X">The Crown of Darkness</a>, you could be the next ruler of this realm.
 If you can unite the dwarf families, you could bring back peace and prosperity.
 If you can help the nagas to restore life and stem the tide of undeath, you could find strong allies for your own struggles elsewhere.
<p>The stats are for <a href="https://alexschroeder.ch/pdfs/Halberts.pdf">Halberts</a>, where you start with a fully formed character, or <a href="https://alexschroeder.ch/pdfs/Knives.pdf">Knives</a>, where you start with no talents and are expected to work your way up, gaining a point every year.
 Think of it as some sort of <em>Fantasy Traveller</em> with attributes usually in the 2–12 range.

# The map always has the same structure, for the moment.
# Each location has either three exists, or it’s a dead end with just one exit.
#
# Each location is defined by a set of variables.
# The single letter variable contains the unique name.
# The single letter + "_type" is the location type.
# This is done so that the name and content matches the location type.
#
# Note that names are unique! There must be plenty of alternatives or you’ll
# get recursion "Recursion deeper than 20" errors in the log.

;map setup
1,[A@location][setup]
[B@location][setup]
[C@location][setup]
[D@location][setup]
[E@location][setup]
[F@location][setup]
[G@location][setup]
[H@location][setup]
[I@location][setup]
[J@location][setup]
[K@location][setup]
[L@location][setup]
[M@location][setup]
[N@location][setup]
[O@location][setup]
[P@location][setup]
[Q@location][setup]
[R@location][setup]
[S@location][setup]
[[newt court name]@T]
[naga lair@U_type][[[@U_type] name]@U]
[[spider city name]@V]
[[ghoul city name]@W]
[[myrkheim crown name]@X]

# [@location] is a letter like A
# [[location type]@[@location]_type] is [[location type]@A_type] is the location type and storing it in variable A_type.
# [[[@[@location]_type] name]@[@location]] is [[[@A_type] name]@A] is [[tunnels name]@A] is a tunnel name storing it in A.

;setup
1,[[location type]@[@location]_type][[[@[@location]_type] name]@[@location]]

;map description
1,[A@location][description]
[B@location][description]
[C@location][description]
[D@location][description]
[E@location][description]
[F@location][description]
[G@location][description]
[H@location][description]
[I@location][description]
[J@location][description]
[K@location][description]
[L@location][description]
[M@location][description]
[N@location][description]
[O@location][description]
[P@location][description]
[Q@location][description]
[R@location][description]
[S@location][description]
[T@location][newt court]
[U@location][description]
[V@location][spider city]
[W@location][ghoul city]
[X@location][myrkheim crown]

# [@Location] is a letter like A
# [@[@location]] is [@A] is the name of a location like "The Caves of Spiders"
# [@[@location]_type] is [@A_type] is the location type like "spider lair"
# [[@[@location]_type] description] is [[@A_type] description] is [spider lair description] is the actual description

;description
1,<h2 id="[@location]">[@[@location]]</h2>
<p>[[@[@location]_type] description]
<p>From here, tunnels lead to [[@location] neighbours].

;A neighbours
1,[F@1][G@2][B@3][neighbour links]
;B neighbours
1,[A@1][I@2][C@3][neighbour links]
;C neighbours
1,[D@1][B@2][K@3][neighbour links]
;D neighbours
1,[E@1][M@2][C@3][neighbour links]
;E neighbours
1,[O@1][F@2][D@3][neighbour links]
;F neighbours
1,[Q@1][E@2][A@3][neighbour links]
;G neighbours
1,[R@1][A@2][H@3][neighbour links]
;H neighbours
1,[G@1][S@2][I@3][neighbour links]
;I neighbours
1,[B@1][H@2][J@3][neighbour links]
;J neighbours
1,[I@1][K@2][T@3][neighbour links]
;K neighbours
1,[C@1][L@2][J@3][neighbour links]
;L neighbours
1,[M@1][U@2][K@3][neighbour links]
;M neighbours
1,[N@1][D@2][L@3][neighbour links]
;N neighbours
1,[O@1][V@2][M@3][neighbour links]
;O neighbours
1,[P@1][N@2][E@3][neighbour links]
;P neighbours
1,[W@1][Q@2][O@3][neighbour links]
;Q neighbours
1,[P@1][F@2][R@3][neighbour links]
;R neighbours
1,[Q@1][X@2][G@3][neighbour links]
;S neighbours
1,<a href="#H">[@R]</a>
;T neighbours
1,<a href="#J">[@J]</a>
;U neighbours
1,<a href="#L">[@L]</a>
;V neighbours
1,<a href="#N">[@N]</a>
;W neighbours
1,<a href="#P">[@P]</a>
;X neighbours
1,<a href="#R">[@R]</a>

;svg map
1,<h2 id="Z">Map</h2>
<svg
  viewBox="0 0 800 400"
  xmlns="http://www.w3.org/2000/svg">
<g id="map"></g>
</svg>

;neighbour links
1,<a href="#[@1]">[@[@1]]</a>, <a href="#[@2]">[@[@2]]</a> and <a href="#[@3]">[@[@3]]</a>

;location type
1,tunnels
1,shrine to [power]
2,[lair]

;power
1,Set
1,Pazuzu
1,Orcus
1,Hecate
1,Mitra

;lair
1,spider lair
1,goblin lair
1,ghoul lair
1,myconid lair
1,naga lair
1,salamander lair
1,newt lair

# Each tunnel has a monster and the name of the monster gives it away.
# Expects @location to be set.
# Sets: @A_monster and @A_condition.

;tunnels name
1,The [Warrens|Tunnels|Caves|Caverns|Passage|Long Crawlies|Low Passage] of [tunnel creature name]

;tunnel creature name
1,Worms[worm@[@location]_monster][dry@[@location]_condition]
1,Wyrms[worm@[@location]_monster][dry@[@location]_condition]
1,Eels[eel@[@location]_monster][wet@[@location]_condition]
1,Darkness[spider@[@location]_monster][dry@[@location]_condition]
1,Spiders[spider@[@location]_monster][dry@[@location]_condition]
1,Crabs[crab@[@location]_monster][wet@[@location]_condition]
1,Night[undead@[@location]_monster][dry@[@location]_condition]
1,Troglodytes[human@[@location]_monster][dry@[@location]_condition]
1,Cannibals[human@[@location]_monster][dry@[@location]_condition]
1,Ticks[spider@[@location]_monster][dry@[@location]_condition]
1,Lampreys[eel@[@location]_monster][wet@[@location]_condition]
1,Crocs[croc@[@location]_monster][wet@[@location]_condition]
1,Slime[slime@[@location]_monster][wet@[@location]_condition]
1,Disease[warp@[@location]_monster][dry@[@location]_condition]
1,the Dead[undead@[@location]_monster][dry@[@location]_condition]
1,Entrails[warp@[@location]_monster][wet@[@location]_condition]
1,the Choker[human@[@location]_monster][dry@[@location]_condition]
1,Bones[undead@[@location]_monster][dry@[@location]_condition]

;shrine to Set name
1,The Great Set [shrine type]
1,The [shrine type] of the [Serpent|Naga|Seven-Headed] King
1,The [shrine type] for the Lord of [Assassins|Murderers|Poisoners|Thieves|Sweet Words]
1,The [shrine type] of [Retribution|Revenge|Justice|Punishment]
1,The [shrine type] for the Prince of [Intrigue|Whispers|Flatteries|Charms]
1,The [shrine type] of the Great [Snake|Serpent|Whisperer|Stare|Maw]
1,The [shrine type] of the [Deadly|Silent|Slow] Hunter
1,The [shrine type] for the King of [the Underworld|the Earth|All Snakes]

;shrine to Pazuzu name
1,The Last Pazuzu [shrine type]
1,The [shrine type] of the [Vulture|Dark Sky|Four-Winged] King
1,The [shrine type] for the Lord of [Disease|Pestilence|Miasmas]
1,The [shrine type] of [Wishes|Fulfilment|Satisfaction|Promises]
1,The [shrine type] for the Prince of [Promises|Delusion|Dreams]
1,The [shrine type] of the Great [Deliverer|Vulture|Winged One]
1,The [shrine type] for the King of [the Underworld|Red Skies|Birds]

;shrine to Orcus name
1,The Main Orcus [shrine type]
1,The [shrine type] of the [Goat|Horned|Hairy|Pot-Bellied|Trickster] King
1,The [shrine type] for the Lord of [Lies|Deception|the Dead]
1,The [shrine type] of [Rebirth|the Afterlife|the Dead|Undeath|Preservation|Dancing Bones]
1,The [shrine type] for the Prince of [Undeath|the Underworld|Bones|Skeletons]
1,The [shrine type] of the Great [Horned One|Deceiver]

;shrine to Hecate name
1,The Dark [shrine type] of Hecate
1,The [shrine type] of the [Hell-Hound|Three-Faced] Queen
1,The [shrine type] at the [Crossroads|Intersection|Fork]
1,The [shrine type] for the Queen of [Magic|Wild Hogs|Ravens|Dogs|All Ages|Warp and Weft]
1,The [shrine type] of [Stars|the Three Black Hounds]
1,The [shrine type] for the [Princess of Eternal Youth|Old Crone]
1,The [shrine type] of the Great [Weaver|Spinster|Warp|Weft]

;shrine to Mitra name
1,The Great Underground Flame of Mitra
1,The [shrine type] of the [Eternal Flame|Glorious Bull|Oath Bound]
1,The [shrine type] of the Protector of all [Oaths Sworn|Promises Made|Ties|Frienship|Family|Friends]
1,The [shrine type] of the Lady of [All Bulls|Underground Loyalty|All Bonding]
1,The [shrine type] of [Loyalty Unwavering|Promises Kept]
1,The [shrine type] of [Candles|Fires]
1,The [shrine type] of [Copper|Brass|Bronze] Braziers

;shrine type
1,Shrine
1,Altar

;spider lair name
1,The [Silk|Web|Net] [Spinner|Crafter|Maker|Weaver]’s [Den|Hole|Abode|Hideout|Lair]
1,The [Silky|Webbed|Netted|Many-legged] [Trap|Pit|Chasm|Hole|Shaft]
1,She-Who-[Waits|Hunts|Preys|Spins]-In-[The-Dark|Silk|Silence]
1,The Silk Mummies
1,The [World|Cave|Underworld] [Wide|Spanning|Covering] Web
1,The Threads of [Time|Death|Silk|Agony|No Return|Hope]
1,The [Pantry|Garde manger|Graveyard|Gallows]
1,Where Bugs Used To Roam
1,The Lace of [Dreams|Nightmares|Silk]
1,Mommy-Eight-Legs

;spider city name
1,The Great [Web|Net]
1,Arachnopolis
1,The City of [Webs|Weavers]
1,The City Above
1,The Field of Bones
1,The [Web|Net] of Thousands

;goblin lair name
1,The Great Market
1,The City of Opportunity
1,The Labyrinth
1,The Home of the Spider Knights
1,The Fortress of Assassins

;ghoul lair name
1,The Old Battlefield
1,The Fields of Graves
1,The Restless Dead
1,The Maggots of the Earth
1,The Cemetery of Despair

;myconid lair name
1,The Garden of Darkness
1,The Dreamlands
7,The [myconid lair 1 name] [myconid lair 2 name]

# all of these end in “name” so that we don’t get repeats

;myconid lair 1 name
1,Great
1,Terrible
1,Poisoned
1,Decaying
1,Sunless
1,Sulphur
1,Methane

;myconid lair 2 name
1,Bog
1,Rot
1,Swamp
1,Garden
1,Forest
1,Goo
1,Land

;naga lair name
1,The [naga lair 1 name] of [naga lair 2 name]

;naga lair 1 name
1,Baths
1,Castle
1,Citadel
1,Hatchery
1,Library
1,Palace
1,Refuge
1,Well

;naga lair 2 name
1,Delight
1,Dreams
1,Paradise
1,Peace
1,Wisdom
1,Knowledge
1,the Deep
1,Souls

;newt lair name
1,The [newt lair 1 name] [newt lair 2 name]

;newt lair 1 name
1,Water
1,Cold
1,Watery
1,Sunken
1,Dark
1,Slow
1,Ancient
1,Old

;newt lair 2 name
1,Palace
1,Grave
1,City
1,Cave
1,Cistern
1,Reservoir
1,Lake

;salamander lair name
1,The [salamander lair 1 name] of [salamander lair 2 name]

;salamander lair 1 name
1,Palace
1,Garden
1,Refuge
1,Caverns
1,Solace
1,Restoration

;salamander lair 2 name
1,Silence
1,Dreams
1,Delight
1,Water
1,Peace
1,Quiet
1,Calm

# We expect @location to be set to a letter such as A, as well as @A_condition and @A_monster.

;tunnels description
1,[[@[@location]_condition] tunnels description]
<p>If the encounter drags, roll up a second party on the <a href="#random">random encounter table for tunnels</a>.

;wet tunnels description
1,There’s is water from above somewhere.
 Did it rain or does it always flow through these tunnels?
 You’re knee-deep in muddy water. It’s cold.
<p>[[@[@location]_monster] tunnels]
1,The tunnels are flooded. Perhaps you though you could walk, but you cannot.
 Others have faced similar problems over the years. There are old boats to be found.
 Ancient traditions maintain them. You can row through these tunnels.
<p>[[@[@location]_monster] tunnels]
1,Everything is under water. Movement is slow. If you slip, you might drown. You move carefully.
 If only you could see the ground.
<p>[[@[@location]_monster] tunnels]

;eel tunnels
1,There are silver eels to be found, here.
<blockquote>Silver eels: [nightling]</blockquote>
1,The electrical eels hate it when you come too close.
<blockquote>Electrical eels: [nightling] Lightning-[2d6]</blockquote>
1,The lampreys are waiting for warm blood.
<blockquote>Lampreys: [nightling] Sneaking-[2d6]</blockquote>

;crab tunnels
1,The rocks rising out of the water are full of small animals, waving their claws at you.
 If you move towards them, they move back. If you don’t budge, they come closer.
 The clicking of their claws, the clacking of their spindly legs, there must be many thousands down there.
1,The water is cloudy with a gelatinous substance full of gelatinous balls.
 Crab eggs. With every step, you have to tear through it.
 They’re surprisingly large.
[crabs]

;crabs
1,<blockquote>[crab name]s: [nightling]</blockquote>

;crab name
1,[Chthonic|Night|Meat|Red|Blue|Blind|Giant|Spider] [Crab|Pincer]

;croc tunnels
1,The water is dead still but if you shine a light into the distance, dozens of eyes reflect back.
 Underworld crocodiles lie under the water surface like dead logs, endlessly patient, saving the energy of a year for that one sprint after their victim.
 They’re just waiting for you to make a mistake.[croc table]
1,What looks like logs floating in the water are actually crocodiles. They seem to be in some sort of deep cold stupor.
 Saving energy, waiting for that disturbance in the flow. Those warm water eddies to that say in a thousand sweet words:
 food.[croc table]

;croc table
1,<blockquote>[croc name]s: [predator]</blockquote>

;croc name
1,[Chthonic|Sleeper|Slow|Deep Time|Zombie|Shark|Blind] [Croc|Gator|Crocodile]

;slime tunnels
1,The light catches huge blogs of [red|green|purple] slime along the ceiling.
 Slowly, a thousand drops glide down long threads into the water below.
<blockquote>Make a Dexterity check to avoid [1d4] Damage.</blockquote>
1,Whenever a stone rises out of the water it’s covered in [red|green|purple] slime.
 It’s tricky to avoid when getting into or out of the water.
<blockquote>Make a Dexterity check to avoid [1d4] Damage.</blockquote>

;dry tunnels description
1,This is one of the veins of the earth, a shaft going down and down and down into the blackness.
 An ancient civilisation has carved footholds into the walls.
 There are platforms to rest every now and then.
 None of this is secured.
 You tie yourselves to the walls when you sleep.
 Small rings have been used for this purpose by a thousand travellers before you.
<p>[[@[@location]_monster] tunnels]
1,The passage winds and twists, the walls coming closer and closer.
 At last, you squeeze sideways through narrow passages, the weight of the rocks preventing you from taking a deep breath.
<p>[[@[@location]_monster] tunnels]
1,The passages have been dug by goblins and dwarves.
 First, you stoop. Then you crawl.
 On your ellbows and belly, sliding between wet stones, pulling bags on ropes after you, trusting the signs, praying that you never get stuck.
<p>[[@[@location]_monster] tunnels]
1,The passage here is a crack between boulders. Safe passages have been marked by ancient carvings.
 Three scratches, a humanoid may pass. Avoid the ones with the wavey line and circle: those passages require gills.
 The cracks between boulders go deep. Sometimes you can’t see the bottom. Sometimes you see a thousand skulls.
 Ancient burial grounds of troglodytes? Or discard piles for giant cave owls.
<p>[[@[@location]_monster] tunnels]
1,Again and again, there are walls to climb.
 The existing holes have been used for stakes and wedges by thousands of travellers before you.
 Each one carefully removing the metal spikes when the last one had gone. They are too valuable to leave behind.
<p>[[@[@location]_monster] tunnels]

;worm tunnels
1,There are terrible annelids to be found, here.
 They hide in the shadows, laying in wait, cold and lifeless.
 But vibrations, movement, sound, warm breath – it wakes them up.
[worm attack]
[worms]

;worm attack
1,They sneak up on you as you rest.
1,The fall from above as you pass beneath them.
1,They attach themselves as you crawl past them.

;worms
1,<blockquote>[Rock|Stone|Blood|Bore|Flesh] [Worms|Maggots|Leeches]: [nightling] Sneaking-[2d6]</blockquote>

;spider tunnels
1,You crush chitinous husks and thin bones beneath your feet.
 Where do they come from? The ceiling is far above you in this narrow cleft deep beneath the surface.
 Occasionally, you hear a struggle up above in the darkness.
 Soon, another empty arthropod husk drops from above.
[spider attack]
[spiders]
1,Again and again you wipe spiderwebs from your faces as you advance.
 When the webs are larger, the sticky strands are stronger.
 Your advance slows to a crawl.
 Blades are full of spiderweb goo, making it impossible to cut the strands.
 The strands are also hard to tear for they just stretch and give and then they snap back.
[spider attack]
[spiders]
1,The walls are full of dried husks of some sort of long moss.
 Impossible of course. It’s pitch black down here.
 A sort of fungus?
[ticks attack]
[ticks]
1,The tunnels are full of round stones like a dried-up river bottom.
 Every step you take the stones grind and groan, shifting ever so slightly.
 You move carefully and it’s tiring.
[ticks attack]
[ticks]

;spider attack
1,<p>These spiders hunt.
 They run along the walls.
 They jump from rock to rock.
1,<p>Silently, the spiders lower themselves from above.
1,<p>Silently, legs outstretched, the spiders descend from the darkness above.

;ticks attack
1,<p>When you take a rest, the darkness starts to move.
 Fist you hear a faint rustling and then you see some of the round stones move.
 They have eight legs, and they’re coming at you from all directions.

;ticks
1,<blockquote>Ticks: [predator]</blockquote>

;undead tunnels
1,There are side passages filled to the brim with bones.
 An ancient people must have filled these caves with their dead.
 And all these corpses have attracted attention, eventually.
[ghouls]
<p>They have gnawed on these bones for a hundred years.
 There are no more bones to pick.
 Except for yours.
1,You pass crushed doors made of stone.
 Behind the debris are collapsed tunnels.
 In those tunnels, the graves of a forgotten people.
 And you know what happens to the bones of the aggrieved.
 They animate.
[ghouls]
<p>It is impossible to make this right.
 Who in their right mind would want to help you rebury all the dead?
1,You’ve passed a few of these pits by now.
 Down below you can see skulls and bones.
 These used to be flesh pits.
 Now it’s all gone.
<p>Except for this pit.
 There’s people climbing up to meet you.
[ghouls]

;human tunnels
1,[human presence]
[human activity]
[human quote]

;human presence
1,<p>There’s a faint smell of smoke in the air.
 Soon, a flicker of light. A fire is burning somewhere.
 Murmuring voices. Humans.
 They seem to be working on something while one of them is reciting a poem.
<blockquote>[[human name]@name][@name] and their [human style] followers: [human] Craft-[2d6] [Singing|Oratory]-[2d6] [Climbing|Running]-[2d6]</blockquote>
1,<p>Surprisingly, you hear singing.
 Humans! Nobody else is known to sing.
<blockquote>[[human name]@name][@name] and their [human style] followers: [human] [Craft|First Aid|Oratory]-[2d6] Singing-[2d6] [Climbing|Running]-[2d6]</blockquote>
1,<p>You hear a voice, reciting something. A poem?
 Humans! Nobody else is known to recite poetry.
<blockquote>[[human name]@name][@name] and their [human style] followers: [human] Oratory-[2d6] Singing-[2d6] [Climbing|Running]-[2d6]</blockquote>
1,<p>Above you, some humans have set up a defensive position.
 They have rocks to throw and they have secured some chimneys with ropes for a retreat.
<blockquote>[[human name]@name][@name] and their [human style] followers: [human] Climbing-[2d6] [Craft|First Aid|Oratory|Singing]-[2d6] Tactics-[2d6]</blockquote>

;human activity
1,<p>They have posted guards.
1,<p>Their camp is guarded by a dog.
<blockquote>[Loyal|Scrawny|Mangy] dog: Hit-[2d6] Damage-[2d6] Endurance-[3d6] Life-[2d6]</blockquote>
<p>The dog notices your smell long before you can see it.
1,<p>The presence of humans has attracted [wild|feral] dogs.
 The dogs sneak around the human camp, keeping out of the light, waiting for scraps of food.
<blockquote>[Night|Shadow|Tunnel] [Dog|Wolf|Fox]: [nightling] Running-[1d6+6]</blockquote>
<p>These dogs notice your smell long before you can see them.

;human quote
1,<blockquote>[@name] says: “What brings you here?
 Have you seen any temples worth looting?”</blockquote>
1,<blockquote>[@name] says: “Are you as lost as we are?
 We are looking for a way out of Myrkheim.
 This dark hell is going to kill us unless we make it out of here.”</blockquote>
1,<blockquote>[@name] says: “The gods have forsaken us.
 We are the demon worshipping hunters of Myrkheim.”</blockquote>
1,<blockquote>[@name] says: “Many generations ago, demons tricked our forbears.
 They promised them a realm of their own.
 And here we are, in this godforsaken place.”</blockquote>
1,<blockquote>[@name] says: “Who are you?
 Servants of Set, Pazuzu, Orcus?
 Be warned. Demon spawn is not welcome, here.”</blockquote>

;human
1,Number-[2d6] Attack-[2d6] Escape-[2d6] Hit-[2d6] Damage-[2d6] Endurance-[2d6] Life-[2d6]

;human style
1,cannibal
1,feral
1,troglodyte
1,downtrodden
1,rowdy
1,silent
1,grumpy

;human name
1,Ada
1,Ageric
1,Agnes
1,Alard
1,Alaric
1,Alice
1,Amaury
1,Beatrice
1,Bela
1,Bero
1,Berta
1,Brunhild
1,Cecilia
1,Childeric
1,Chlodomer
1,Colin
1,Dagobert
1,Drogo
1,Elena
1,Emma
1,Fina
1,Forwin
1,Fulk
1,Gamel
1,Gararic
1,Gerard
1,Gisela
1,Golda
1,Grimald
1,Gunderic
1,Gundobad
1,Helen
1,Hilda
1,Hugh
1,Huneric
1,Ida
1,Ingomer
1,Isolda
1,Joan
1,Jocelin
1,Lora
1,Lothar
1,Marachar
1,Maud
1,Muriel
1,Norman
1,Odo
1,Osbert
1,Otker
1,Pepin
1,Radegund
1,Ranulf
1,Sigeric
1,Sigibert
1,Sybil
1,Terric
1,Thurstan
1,Vuldretrada
1,Warin
1,Wymarc
1,Ymbert

;warp tunnels
1,[warp effect]
[warp ghouls]
1,[warp moth]

;warp effect
1,The tunnels here are filled silent screaming of the warp.
 Every stone you touch wants to scream.
 It’s hard to focus.
 Hands tremble.
 Jaws clench.
1,The warp is howling.
 Behind every stone it whimpers.
 Down every tunnel it cries.
 It fills your soul.
 You want to howl with it.

;warp ghouls
1,<p>The walls are bleeding.
 Claws have scratched them raw.
 It is a festering wound.
[ghouls]
<p>These ghouls use their bleeding claws to scrawl blood letters.
<blockquote>[@name] squeals: “We paint the sigils of Death.
 We open the gates to the void.
 Between the realms we shall find peace.
 The warp will take us.”</blockquote>
1,<p>In the darkness, gibbering ghouls cower and shake.
 Their madness has been replaced by an even greater madness.
[ghouls]
<p>As you approach, they claw the ground, they whimper.
 They bite their own arms. They cry.
<blockquote>[@name] whisper: “Leave us. Leave us!
 This is our hell. The cannibal spirits are upon us.
 Leave while you can or we will eat you.”</blockquote>
1,<p>As the tunnels opens, you see ghouls overhead.
[ghouls]
<p>They grin. They cackle. They call for you.
<blockquote>[@name] shouts: “Blood of the living!
 Meat for the dead!
 Meat for the dead!”</blockquote>
<p>They howl.
1,<p>Bones have been tied together into strange statues on spider legs.
<p>You can see ghouls working on a sort of spider-[bear|wolf|angel].
 They stop as you come closer.
[ghouls]
<p>The mummified corpses are half-eaten and sewn together.
 Teeth and hair and skin and nails.
 The necrotic sculptures cut the soul.
<blockquote>[@name] whispers: “We are the puppet masters.
 The astral bonds that keep you alive, we weave turn into rope, and with it we strangle your souls.”</blockquote>

;warp moth
1,A sweet perfume fills the air. So sweet. So strong.
<p>The air is heavy now, inhale the intoxicating scent feel the world go out of focus.
<p>And then, the colours. Iridescent colours, kaleidoscopic transitions, fractal patterns turning, falling, crawling.
<p>Finally, the giant moth hanging on the wall, its wings opening and closing, prismatic lights dancing on the walls.
 The illusions of friends and family, crying children.
 Your loved ones coming back from the afterlife.
<blockquote>Warp moth: Number-1 Attack-[1d6+6] Escape-[1d6] Hit-[1d6+7] Damage-[2d6] Endurance-[2d6] Life-[1d6] Charm-[1d6+6] Illusion-[2d6]</blockquote>
<p>It is only later that you see all the skulls and bones lying below it.

;tunnels random encounters
1,<h2 id="random">Random Tunnel Encounters</h2>
<p>Roll on this table when time crawls.
 Roll on this table when an ordinary encounter drags.
 Roll on this table when the players are eager for action.
<p>Monster stats: Roll 2d6 ≤ attributes for checks.
 Note that monsters don’t use attribute + talent for checks like player characters do.
 <em>Special</em> is an extra attribute, possibly magical.
 The exact effects are to be negotiated.
 <em>Numbers</em> is the number of creatures encountered.
 Check <em>Attack</em> to see whether they want to fight.
 If not, check <em>Escape</em> to see if they want to retreat.
 If not, they want to talk.
 In a fight, check <em>Hit</em> to see if they land a hit.
 If so, check <em>Damage</em> to see how much damage they deal.
 If they are hit, <em>Endurance</em> is how much damage they can take and stay conscious,
 as well as the number of attacks they can make.
 <em>Life</em> is how much damage they can recover from. If it runs out, they die.
<table id="encounters">
<thead>
<tr><th class="c">2d6</th><th>Name</th><th>Special</th><th title="Number">Num.</th><th title="Attack">Att.</th><th title="Escape">Esc.</th><th>Hit</th><th title="Damage">Dam.</th><th title="Endurance">End.</th><th>Life</th></tr>
</thead>
<tbody>
<tr><td class="c">2</td>[random dragon]</tr>
<tr><td class="c">3</td>[random undead]</tr>
<tr><td class="c">4</td>[random predator]</tr>
<tr><td class="c">5</td>[random dwarf]</tr>
<tr><td class="c">6</td>[random nightling]</tr>
<tr><td class="c">7</td><td colspan="8"><a href="#known">Known characters</a></td></tr>
<tr><td class="c">8</td>[random myconids]</tr>
<tr><td class="c">9</td>[random snakelings]</tr>
<tr><td class="c">10</td>[random predator]</tr>
<tr><td class="c">11</td>[random undead]</tr>
<tr><td class="c">12</td>[random giant]</tr>
</tbody>
</table>
<p>More dwarf names: [dwarf name], [dwarf name], [dwarf name], [dwarf name], [dwarf name], [dwarf name], [dwarf name], [dwarf name].
<p>More snakeling names: [snakeling name], [snakeling name], [snakeling name], [snakeling name], [snakeling name].
<h2 id="known">Known characters</h2>
<p>Add to the list of known characters for 7 as play progresses.
 Whenver players enjoy some interaction with non-player characters, add them and make it work when you roll them up.</p>
<ol>
<li>Brá the dwarf, trying to find and kill Banupal of Tsathoggua’s grace; Attack-9 Escape-4 Hit-7 Damage-6 Endurance-4 Life-2 (non-player character by <a href="https://tabletop.social/@kensanata">@kensanata</a>).
<li>Adalmunt the magic user searching for eternal life; Strength-8 Dexterity-7 Endurance-6 Intelligence-10 Education-9 Status-7 Fire-2 Literacy-2 Necromancy-2 Transmutation-2 Doors-1 Eyes-1 Fusion-1 Plants-1 Shapeshift-1 (character by <a href="https://tabletop.social/@phf">@phf</a>)
<li>Dagobert the horseless knight, looking for a way back to his castle; Strength-3 Dexterity-8 Endurance-10 Intelligence-9 Education-2 Status-10 Behavior-1 Bureaucracy-2 Craft-2 Construction-1 Lance-1 Riding-1 Singing-1 Spear-2 Spying-2 (character by <a href="https://mstdn.games/@frotz">@frotz</a>)
<li>Matthieu the assassin who got sidetracked from his job – the murder of Chlodoman the pyromancer; Strength-2 Dexterity-7 Endurance-9 Intelligence-4 Education-10 Status-7 Running-1 Distract-2 Oratory-1 Brewing-1 Behavior-4 (character by <a href="https://freeradical.zone/@PresGas">@PresGas</a>)
<li>
<li>
</ol>

;nightling
1,Number-[2d6] Attack-[1d6+4] Escape-[1d6+3] Hit-[1d6+5] Damage-[2d6] Endurance-[1d6] Life-[1d6]

;random nightling
1,<td>[nightling name], nightlings</td><td>[Sneaking|Running|Distract]-[2d6]</td><td class="c">[1d6]</td><td class="c">[1d6+4]</td><td class="c">[1d6+3]</td><td class="c">[1d6+5]</td><td class="c">[2d6]</td><td class="c">[1d6]</td><td class="c">[1d6]</td>

;nightling name
1,[Night|Earth|Cave|Under|Stone|Fire|Tar|Chthonic|Nimble|Myrk][ Hunter| Goblin| Nomad|dwarf|jäger| Stalker|ling| Knive]s

;random dwarf
1,<td>[dwarf name] and other dwarves</td><td>[Crafting|Singing|Construction]-[2d6]</td><td class="c">[2d6]</td><td class="c">[1d6+4]</td><td class="c">[1d6+3]</td><td class="c">[1d6+5]</td><td class="c">[2d6]</td><td class="c">[1d6]</td><td class="c">[1d6]</td>

;random myconids
1,<td>[myconid name] and other myconids</td><td>Charm-[2d6]</td><td class="c">[1d6]</td><td class="c">[1d6+4]</td><td class="c">[1d6+3]</td><td class="c">[1d6+5]</td><td class="c">[2d6]</td><td class="c">[1d6]</td><td class="c">[1d6]</td>

;random snakelings
1,<td>[snakeling name] and other snakelings</td><td>[Charm|Shapeshift|Sleep]-[2d6]</td><td class="c">[2d6]</td><td class="c">[1d6+4]</td><td class="c">[1d6+3]</td><td class="c">[1d6+5]</td><td class="c">[2d6]</td><td class="c">[1d6]</td><td class="c">[1d6]</td>

;predator
1,Number-[2d6] Attack-[1d6+5] Escape-[1d6+2] Hit-[1d6+6] Damage-[2d6] Endurance-[3d6] Life-[2d6]

;random predator
1,<td>[predator name], predator</td><td>[Sneaking|Tactics]-[2d6]</td><td class="c">1</td><td class="c">[1d6+5]</td><td class="c">[1d6+2]</td><td class="c">[1d6+6]</td><td class="c">[2d6]</td><td class="c">[3d6]</td><td class="c">[2d6]</td>
5,<td>[predator name]s, predators</td><td>[Sneaking|Tactics]-[2d6]</td><td class="c">[1d5+1]</td><td class="c">[1d6+5]</td><td class="c">[1d6+2]</td><td class="c">[1d6+6]</td><td class="c">[2d6]</td><td class="c">[3d6]</td><td class="c">[2d6]</td>

;predator name
2,[Cave|Under|Dark|Earth] [Lion|Bear|Gator|Worm|Choker]
1,[Chthonic|Carnivorous|Slow|Deep] [Lion|Bear|Croc|Worm|Choker]

;undead
1,Number-[2d6] Attack-[1d6+6] Escape-[1d6] Hit-[1d6+7] Damage-[2d6] Endurance-[3d6] Life-[4d6]

;random undead
1,<td>[undead name], undead</td><td>Necromancy-[2d6]</td><td class="c">1</td><td class="c">[1d6+6]</td><td class="c">[1d6]</td><td class="c">[1d6+7]</td><td class="c">[2d6]</td><td class="c">[3d6]</td><td class="c">[4d6]</td>
5,<td>[undead name]s, undead</td><td>Necromancy-[2d6]</td><td class="c">[1d5+1]</td><td class="c">[1d6+6]</td><td class="c">[1d6]</td><td class="c">[1d6+7]</td><td class="c">[2d6]</td><td class="c">[3d6]</td><td class="c">[4d6]</td>

;undead name
1,[Bone|Meat|Flesh|Soul|Life][breaker|biter|breaker|sucker|grinder|rot]

;giant
1,Number-1 Attack-[1d6+3] Escape-[1d6] Hit-[1d6+8] Damage-[4d6] Endurance-[8d6] Life-[4d6]

;random giant
1,<td>[giant name], giant</td><td>[Fire|Earth]-[2d6]</td><td class="c">1</td><td class="c">[1d6+3]</td><td class="c">[1d6]</td><td class="c">[1d6+8]</td><td class="c">[4d6]</td><td class="c">[8d6]</td><td class="c">[4d6]</td>

;giant name
1,Nazarbubu the Raging
1,Dapānu the Violent
1,Emūqattam the Forceful
1,Lapātu the Iron Fist
1,Parzillu the Iron
1,Līlum the Dark
1,Gilittu the Terror
1,Kuppû the Cold
1,Naḫarmuṭu the Dissolver

;dragon
1,Number-1 Attack-[1d6+2] Escape-[1d6] Hit-[1d6+9] Damage-[5d6] Endurance-[10d6] Life-[5d6]

;random dragon
1,<td>[fire dragon name], dragon</td><td>Fire-[2d6]</td><td class="c">1</td><td class="c">[1d6+2]</td><td class="c">[1d6]</td><td class="c">[1d6+9]</td><td class="c">[5d6]</td><td class="c">[10d6]</td><td class="c">[5d6]</td>
1,<td>[ice dragon name], dragon</td><td>Cold-[2d6]</td><td class="c">1</td><td class="c">[1d6+2]</td><td class="c">[1d6]</td><td class="c">[1d6+9]</td><td class="c">[5d6]</td><td class="c">[10d6]</td><td class="c">[5d6]</td>

;fire dragon name
1,Gīru the Flame
1,Ḫamātu the Burning
1,Qalû the Burning
1,Qadû the Ardent
1,Šitpû the Flare

;ice dragon name
1,Mušḫuššhu the Serpent
1,Šēzuzu the Fierce
1,Ušumgallu the Great
1,Ušumgallatu the Monarch
1,Akālu the Hungry
1,Belû the Extinguisher

;shrine to Set description
1,[set shrine]
[set decoration]
[Charm@special][[dwarves|snakelings]]
[set activity]
[set quote]

;set shrine
1,Braziers filled with green fire illuminate a pyramid.
 Stairs lead up to a seven-headed snake statue.
 This is Set.
1,A great stone serpent encircles a temple pyramid of Set.
 A strange liquid forms a kind of moat.
 If you touch it, the [corrosive|caustic] slime deals [1d4] Damage.
 To enter, you must cross the serpent bridge and pass beneath the serpent’s head.
 A constant flow of slime drips from the open mouth, repleneshing the moat.
<blockquote>Make a Dexterity check to avoid [1d4] Damage.</blockquote>
<p>The courtyard is illuminated by green vapours rising from a great brazier.

;set decoration
1,<p>At the foot of the pyramid are statues of snakelings, one after another.
 An endless procession of heroes and dignitaries long forgotten.
1,<p>Two great stone chimaeras stare each other down at the foot of the pyramid.
 Their conflict long forgotten, the symbolism of their [lion|horse|monkey] bodies and their [human|eagle|donkey|bird|dragon] heads lost.

;set activity
1,<p>They serve death and revenge.

;set quote
1,<blockquote>[@name] says:
 “May your enemies rot in hell.
 May your competitors die young.
 May the plague eat their children.”
</blockquote>

;snakelings
1,<blockquote>[[snakeling name]@name][@name] and other snakelings: [nightling] Brewing-[2d6] Charm-[2d6]</blockquote>

;snakeling name
1,Mušgallu the Serpent
1,Ašartu the Desert
1,Ašnugallum
1,Bašmu the Poisonous
1,Burubalûm the Great
1,Gappu the Winged
1,Guṣṣu the Snake
1,Ḫabābu the Hiss
1,Imtu the Venomous
1,Kanānu the Coiled
1,Kitpulu the Wrestler
1,Kuppû the Eel
1,Kusīpu the Snake
1,Nazzizu the Hiss
1,Nišku the Biter
1,Palḫu the Terror
1,Ṣallamtu the Black
1,Ṣarṣaru the Giant
1,Šamāru the Sorcerer
1,Šammānum the Snake
1,Urnu the Snake

;shrine to Pazuzu description
1,[pazuzu shrine]
[pazuzu people]
[[Eyes|Spying]@special][dwarves]
[pazuzu support]
[pazuzu activity]
[pazuzu quote]

;pazuzu shrine
1,<p>In this cavern stands a giant statue of a creature with the beak of a vulture, claws for hands and feet, large insect eyes and four large wings on its back.
 This is Pazuzu, an ancient demon lord associated with the plague.

;pazuzu people
1,<p>At it’s feet stands a dwarf fortress.
 Strong walls to protect against anybody on foot, long spikes to protect against anybody on wings.
 Light burns in watch towers.

;pazuzu support
1,<p>If there’s ever a problem, the dwarves have trained war bears with strange beaks to protect them.
<blockquote>[Beak|Vulture|Eagle|Hawk] Bears: [predator]</blockquote>

;pazuzu activity
1,<p>The dwarves are here to spread the dominion of their demon lord.

;pazuzu quote
1,<blockquote>[@name] says:
 “These lands used to belong to newts and toads.
 We are draining the swamp.
 We bring clarity of purpose.
 We are going to make Myrkheim great again.”</blockquote>

;shrine to Orcus description
1,[orcus shrine]
[orcus people]
[Necromancy@special][dwarves]
[orcus support]
[orcus activity]
[orcus quote]

;orcus shrine
1,<p>In this cavern stands a giant obsidian throne with a hairy pot bellied and horned goat man.
 This is Orcus, the old trickster god that cheated death itself.
 He can bring back the dead and animate their bones.
 There are in fact countless skeletons dancing, illuminated by sulphur light.

;orcus people
1,<p>Around the throne is a labyrinth of bones.
 Huge rib cages with bone houses inside.
 Pyramids of skulls.
 Walls made of giant bones.
 Sharpend femurs to prevent landings.

;orcus support
1,<p>Whenever a stranger approaches, the skeletons stop their dancing and their skulls begin to track you.
<blockquote>Dancing Bones: [nightling]</blockquote>

;orcus activity
1,<p>The congregation is made up of old dwarves.
 These dwarves are so old their hair is thinning out.
1,<p>The dwarves here look pale and sick.
<blockquote>If you mix with them, you will contract the plague.
 Make an Endurance check to avoid it.
 If you contracted it, you get the fever within a few days.
 Make a second check.
 If you make it, those were the worst days of your life.
 If you don’t make it, those were the last days of your life.</blockquote>
<p>Perhaps you can go and find a shrine of Pazuzu to beg for mercy.
 Or there is a healer somewhere to be found?

;orcus quote
1,<blockquote>[@name] says:
 “Has death taken a loved one from you?
 Orcus can help you get them back.”</blockquote>
1,<blockquote>[@name] says:
 “Orcus knows all the tricks.
 Once we have mastered inner death, we shall sneak into Niflheim and free our loved ones.
 All of us are waiting for this occasions.”</blockquote>
1,<blockquote>[@name] says:
 “Death has cheated me of a good life.
 I had a family. The plague took them all.
 Now they suffer in Niflheim under the watchful eyes of Hel.
 But we’re going to bring them back.
 Just you wait.”</blockquote>
1,<blockquote>[@name] says:
 “The dead do not rest for Orcus has given them the power of movement.
 With movement comes action.
 With action comes responsibility.
 Unfortunately, with life does not come wisdom.
 That is still up to us.”</blockquote>

;shrine to Hecate description
1,[hecate shrine]
[hecate people]
[Eyes@special][dwarves]
[hecate support]
[hecate activity]
[hecate quote]

;hecate shrine
1,A dark cavern opens before you.
 A fortress lies here, defended by long iron needles embedded into the walls.
 All approaches are guarded by malevolent red-glowing eyes.

;hecate people
1,<p>This is a dwarf fortress.
 A grim high priest of Hecate protects all travellers with a bitter grin.

;hecate support
1,[hell hound support]

;hell hound support
1,<p>They have hell hounds to support them.
<blockquote>Hell hounds: [predator] Fire-[2d6]</blockquote>

;hecate activity
1,<p>What they value most is the safety of travellers.

;hecate quote
1,<blockquote>[@name] says:
 “The roads must be safe.
 Spiders must be eliminated.
 The wheel turns.
 Their time has come.”
</blockquote>

;shrine to Mitra description
1,[mitra shrine]
[mitra people]
[Fire@special][dwarves]
[mitra support]
[mitra activity]
[mitra quote]

;mitra shrine
1,A great cavern opens up.
 In its middle rises a fortress of massive walls.
 Embrasures point in all directions, the openings glowing little small eyes.
 Behind the walls the flickering light of fire promises comfort and warmth.

;mitra people
1,<p>This is a dwarf fortress.
 A high priest of Mitra serves the safekeeper of all oaths and as a keeper of the flame.

;mitra support
1,[hell hound support]
 
;mitra activity
1,<p>What they value most is honesty.

;mitra quote
1,<blockquote>[@name] says:
 “Down here, everybody lies.
 These lies corrode the ties that bind us.
 The fabric of our society is frail.
 Lies fester in our souls.
 Nobody trusts their neighbour anymore.”
</blockquote>

# needs @special set
;dwarves
1,<blockquote>[[dwarf name]@name][@name] the dwarf and their followers: [nightling] [Brewing|Bureaucracy|Building]-[2d6] [Contruction|Craft|Culture]-[2d6] [Discipline|Diplomacy]-[2d6] [Singing|First Aid]-[2d6] [@special]-[2d6]</blockquote>

;dwarf name
1,Askur
1,Balin
1,Bjarni
1,Brandur
1,Draupnir
1,Dwalin
1,Fundar
1,Gudmundur
1,Gylvi
1,Haugar
1,Heptin
1,Hor
1,Hugin
1,Jórmundur
1,Kilvari
1,Leivur
1,Loftur
1,Mjothar
1,Nár
1,Njálur
1,Nói
1,Norar
1,Nori
1,Nyrin
1,Ógmundur
1,Óssur
1,Regin
1,Sórin
1,Suthri
1,Tróndur
1,Vindalf
1,Virfi
1,Aldís
1,Ása
1,Ásvór
1,Bís
1,Brá
1,Dís
1,Drós
1,Eina
1,Fís
1,Gunna
1,Hjalma
1,Hulda
1,Ida
1,Ingrún
1,Jórunn
1,Kára
1,Lín
1,Naina
1,Nís
1,Oddní
1,Revna
1,Rúna
1,Salvór
1,Signí
1,Sigrun
1,Sólvá
1,Tórunn
1,Unn
1,Urth
1,Várdís
1,Vígdís
1,Yrsa

;goblin lair description
1,[goblin cave]
[goblin homes]
[goblins]
[goblin activity]
[goblin quote]

;goblin cave
1,The hollering and shouting of goblins is hard to miss.
 A rift is up ahead and they have built their rickety bridges across the emptiness.
 If you fall, you’ll probably be caught by spiders webs or die in a tar pit.
1,Goblins are whistling and yelling.
 There is a rift in the earth up ahead and they have built their rickety bridges across it.
 They have set up nets every now and then, just in case.
 Narrow stairs climb up and down the walls.
1,There are rifts in Myrkheim. Gaps as deep as mountains.
 This one here [goes straight down|goes down at an angle].
  
;goblin homes
1,<p>The walls are full of small cave entrances.
 They are all connected by ropes, stairs and bridges.
1,<p>The rift itself is filled by small capsules secured to each other and to the walls by a thousand thrumming ropes.
 In this cordage the goblins move about like sailors in an endless rigging.

;goblins
1,<blockquote>[[goblin name]@name][@name] and their followers: [nightling] Sneaking-[2d6] Tactics-[2d6]</blockquote>

;goblin name
1,Āmir Dami the Blood Shedder
1,Bēlu Dami the King Killer
1,Dā’ikānu the Murderer
1,Dā’iku the Killer
1,Gaṣṣu the Cruel
1,Mungapru the Superior
1,Muneḫḫu the Subduer
1,Mušaggišum the Murderer
1,Mušmītu the Death-Bearing
1,Nērtu the Killer
1,Šaggāšu the Demon Killer

;goblin activity
1,<p>There is much jeering and shouting on the hanging bridges.
 Stones and feces is being flung.
1,<p>The stench of rotting carcasses hangs in the air.
 Goblins on large bats are riding the warm air that rises from below.
<blockquote>Goblin bats: [nightling]</blockquote>
They are hunting flies as large as cats.

;goblin quote
1,<blockquote>[@name] says: “You know how it is.
 We spent a lot of effort building these bridges that you now want to use.
 We don’t mind. Definitely not a problem!
 But we must ask for a small contribution.
 A small toll for builders.”</blockquote>
1,<blockquote>[@name] says: “Have you come to learn from the master?
 Have you come to lick my toes?”</blockquote>
1,<blockquote>[@name] says: “Have mercy on us, oh tall ones!
 We accept your dominion!
 We submit!” Something seems off.
 You get the feeling that more was said than you could make out.</blockquote>
1,<blockquote>[@name] says: “We are the maggots of the earth.
 If something lies fallow, we occupy it.
 If something goes to waste, we take it.
 This place is a shithole and we are its masters!”
 There is much laughter.</blockquote>
1,<blockquote>[@name] says: “We have lost the knowledge of earth blood.
 The magic of Myrkheim no longer supports us.
 I fear that all these structures will one day fall.
 We don’t know how to repair them.”</blockquote>

;ghoul lair description
1,The ceiling recedes up into the darkness and there are niches along the walls and further up, too.
 In each niche there is a statue looking down on you. The graves of a dead civilisation.
 The deep resting places of a people that no longer survives on the surface. There are no new dead to arrive from above.
 There’s only you. As you look up, you notice movement. Ghouls.
[ghouls]
 If you stop, they’ll ask you to come up.
[ghoul quote]
1,Up ahead is a bigger cavern. In it stands a hill covered in graves. An endles amount of gravestones and mausoleums.
 Amidst these graves you see movement. Somebody or something is trying to remain out of sight. Ghouls.
[ghouls]
<p>If you stop, they’ll approach eventually.
[ghoul quote]

;ghouls
1,<blockquote>[[ghoul name]@name][@name] and their followers: [undead] Necromancy-[2d6]</blockquote>

;ghoul name
1,Ardanānu the Phantom
1,Dingiruggû the Ancient
1,Eṣemtu the Bony
1,Eṭemmu the Ghost
1,Imtu the Poisoner
1,Mâtu the Killer
1,Miqittu the Carcass Eater
1,Naḫāru the Withered

;ghoul quote
1,<blockquote>[@name] says: “Our blood runs cold and our hearts are barren.
 We mean you no harm but the hunger gnaws in our bellies.
 Have you anything for us? Anything at all?”</blockquote>
1,<blockquote>[@name] says: “It is not our fault that we cannot rest.
 Sleep and death are brothers and they have turned their back on us.
 There is no salvation.
 There is no life.
 We just go through the motions.”</blockquote>
1,<blockquote>[@name] says: “You want eternal life but no love?
 You want a kingdom but no light?
 Everything we once loved has turned to dust.
 Our hearts are dry.
 No matter how much blood we drink, they can never be filled again.”</blockquote>
1,<blockquote>[@name] says: “We once used to rule the Underworld.
 Ghouls are elemental spirit of the earth, did you not know?
 Our power has waned.
 The old gods took our power.
 The new gods took their power.
 We are left with nothing.”</blockquote>
1,<blockquote>[@name] says: “We used to move freely between the cities of Midgard.
 No graveyard was safe. No battlefield was holy. No plague could stop us.
 We ate them all. But Midgard severed all its ties.
 We can no longer reach it. And they can no longer reach us.”</blockquote>

;ghoul city name
1,The Eternal City
1,The Resting Place of Kings
1,The Graveyard of the Ancients
1,The Last Resting Place
1,The End of Life
1,Eternal Darkness

;ghoul city
1,<h2 id="[@location]">[@[@location]]</h2>
<p>The entrance to this tomb was blown open, its ancient seals ripped apart.
 Beyond it lies cold despair and death. All light dims. The walls are closing in.
 As you descend into the necropolis, the number of dry husks along the walls are piled higher and higher.
<p>Past the [Cavern of Bones|Pit of Skulls] lies the [Hall of the King|Throne Room of Death].
[ghouls]
<p>An undead army of thousands could be raised, here.
<blockquote>[@name] says: “If you want to live forever, you must let go of everything you love.
 Let go of love, of joy, of warmth.
 The embrance of eternity is cold.
 I can teach you.
 Before I do, however, you must burn down the festering cancer of <a href="#U">[@U]</a>.
 Nothing can remain immortal and pure while the nagas keep meddling.”</blockquote>
<p>The power of Necromancy is one of the talents one needs to master to gain <a href="#X">The Crown of Darkness</a>.
 Here is where you could learn it.
<p>From here, a tunnel lead to [[@location] neighbours].

;myconid lair description
1,[myconid cave]
[myconid homes]
[myconids]
[myconid activity]
[myconid quote]

;myconid cave
1,The stench of rot is hard to miss.
 This cavern lies at the bottom of one of rifts in the earth.
 All the dead and dying, all the corpses and all the garbage, where does it all go?
 It falls and falls and then it splatters on these rocks and starts to decompose.
1,The stench is mind numbing.
 This is one of the caverns at the bottom of a long chimney.
 All the sewage, all the garbage, it runs down the walls, it thickens, it drops, it keeps on flowing.
 Forever downwards, collecting tributaries of more refuse.
<p>And then, finally, it all ends here.
 A sea of rotting corpses, liquefied flesh, the excrement of the living, the goo of the dead.
1,The air is fit for retching.
 The refuse of all the creatures living in the bowels of Myrkheim collects here.
 It’s a fermenting swamp of dross, dregs and scum.

;myconid homes
1,<p>Amidst this apocalyptic landscape stand giant mushrooms, their mycelium suffusing the viscous mud.
 In fact, some of these are ambulatory myconids, mushroom people.
1,<p>Along the walls are smaller caves, and from these protective hollows the myconids are watching.
 These are mushroom people.
 Their feet rest in the mud.
1,<p>This goo swamp of decaying material has islands, and on this islands stand congregations of myconids.
 The mushroom people are staring up into the darkness as if awaiting more gifts from above.

;myconids
1,<blockquote>[[myconid name]@name][@name] and their followers: [nightling] Charm-[2d6] Healing-[2d6] Sleep-[2d6]</blockquote>

;myconid name
1,Puṭūru the Mushroom
1,Qatû the Ender
1,Diliptu the Restless
1,Dulpu the Sleepless
1,Ekēmu the Taker
1,Ḫiltu the Sleeper
1,Itūlu the Calm
1,Maṣallu who Shelters
1,Nadû the Gardener
1,Rabbu the Gentle
1,Reḫû the Overflowing
1,Ṣālilu the Restful
1,Ṣallu the Sleeper
1,Šebû the Satisfied
1,Šudlupu the Troubled
1,Tebû the Originator

;myconid activity
1,<p>They seem to be humming softly, in unison.
1,<p>As they look at you, little glow-shrooms start pulsating all around you.
 They are all in sync.

;myconid quote
1,<blockquote>[@name] says: “We were here before it began.
 We will be here when it ends.”</blockquote>
1,<blockquote>[@name] says: “All of death in the plant and animal kingdoms is to our benefit.
 If it kills you, we are happy.
 We will eat you, in the end.”</blockquote>
1,<blockquote>[@name] says: “We cannot be killed.
 No matter who dies, you or I, the caverns of Myrkheim are full of our spores.
 Wherever there is a corpse, wherever there is some warmth, we will be there.
 We are already there, waiting.”</blockquote>
1,<blockquote>[@name] says: “Don’t worry.
 We are not here to fight.
 For if we just wait, we win.
 Our life is eternal.
 Our consciousness is one.”</blockquote>
[@name] says: “We are not afraid.
 They say that undead is consuming Myrkheim, but even the undead will be digested in the end.
 We cannot be stopped.
 No, it is when they stop moving that we win.
 Our spores already colonise their bodies.
 Our children already inhabit their pores.
 We are everywhere.”</blockquote>

;naga lair description
1,The air is warm and there’s light up ahead.
 Soon, glyphs wriggle on the stone walls spilling lemon light.
[naga garden]
[naga building]
[nagas]
[naga activity]
[naga quote]

;nagas
1,<blockquote>[[snakeling name]@name][@name] and other nagas: [undead] [Sleep|Charm]-[2d6] [Culture|Literacy]-[2d6] Earth-[2d6] Plants-[2d6]</blockquote>

;naga garden
1,<p>The cavern is a vertical garden.
 Yellow globes shine warmly.
 Water drips merrily over mossy terrasses.
 Red and blue fishes are swimming in ponds.
 Giant Green Ferns and bushes with white flowers crowd the space.
1,<p>There is a cavern with a small waterfall and a little lake.
 The air is warm and smells of sweet flowers.
 Yellow lines shine warm light from above.
 Around the lake grow bushes bearing heavy flowers.
 A short stone bridge leads to an island.

;naga building
1,<p>In the middle of it all stands a wooden temple with open sides.
 Snake guardians made of stone stand guard.
1,<p>In the center stands a large wooden temple with multiple terraces.
 Snake guardians made of stone guard all the corners and all the entrances.

;naga activity
1,<p>Big snake people are reading scrolls, playing a flute or meditating.
 The intricate patterns on their skin seem to flow as if blown by the softest breeze.
 Their living halberts are never far from their hands.
 Their unblinking eyes are yellow and blue, with vertical pupils. These are snake eyes.

;naga quote
1,<blockquote>[@name] says: “The nagas have kept the rivers and forests spirits at bay in Midgard.
 But now it is us that need your help.
 We need to destroy the evil haunting <a href="#W">[@W]</a>.
 The tide of death must be stopped.”</blockquote>
1,<blockquote>[@name] says: “An old enemy was buried and sealed in <a href="#W">[@W]</a> ages ago
 but the seal has been broken and our enemy walks these tunnels again.
 And so it is upon us to bear this burden.
 To fight undeath.
 Will you join us?
 There is no glory to had, no treasure to be found.
 But we are the guardians of life and they are the champions of death.”</blockquote>
1,<blockquote>[@name] says: “An evil is spreading in the dark.
 It is the promise of eternal undeath.
 It corruption is everywhere, but it’s started <a href="#W">[@W]</a>.
 We need help clearing it out.
 Will you be the ones to turn the tide?”</blockquote>

;salamander lair description
1,Black boulders lie in this caverns, coated with some sort of organic slime.
 Water drips from the ceiling above, forming shallow pools below.
 The ground is slippery.
 And yet, there are people where that move with grace. Salamanders.
[salamanders]
<p>They seem quite busy.
<blockquote>[@name] says: “Shh!
 Your clumsy stumbling about is scaring the fish.
 Don’t move!”</blockquote>
1,A huge cavern was dug, a subterranean church. Blue light is filtering through the haze above.
 It cannot be daylight, and it’s not moon light. Something glows coldly, up there.
 Huge chains dangle from ancient cranes, creaking softly.
 Below them, the ground is black and red for rust and iron deposits.
 Piles of wreckage, faintly iluminated. And there, humanoids with long tails and spears. Salamanders.
[salamanders]
<p>They are staring.
<blockquote>[@name] says: “Do you know these machines?
 Do such machines exist where you come from?”</blockquote>
1,[frog temple]

;salamanders
1,<blockquote>[[salamander name]@name][@name] and their followers: [nightling]</blockquote>

;salamander name
1,Kitturru the Toad Face
1,Bizazû the Unmoved
1,Muṣârānu the Healer
1,Pirinzaḫu the True
1,Dabābu Kīnu the Honest
1,Šēḫu the Wind Breather
1,Napāšu the Breath of Life
1,Na’āšu the Wheezer
1,Rēmu the Compassionate

;frog temple
1,A cavern houses a lake with an ancient frog temple built of stone.
 Stairs lead into the water.
 There are orange lights glowing along the stairs and atop the temple.
 Salamanders can be seen moving about.
[salamanders]
<p>You are being watched.
[frog temple quote]

;frog temple quote
1,<blockquote>[@name] says: “This temple was built by froglings.
 They disappeared from Myrkheim a long time ago.
 If you want, I can show you around.”</blockquote>
1,<blockquote>[@name] says: “The cult of Tsathoggua is gone.
 The froglings worshipped him.
 Or perhaps it was the toadlings.
 They didn’t leave any records.”</blockquote>
1,<blockquote>[@name] says: “At the bottom of this lake sleeps an eye tyrant.
 See those eyes bubbling up? When the tyrant is agitated, there are more of them.
 Lately, the eyes that surface are decaying and dead.
 They used to float around and watch what was going on.
 I think the tyrant is dying.”</blockquote>
<p>It’s true.
 At the bottom of the lake sleeps a sick Eye Tyrant.
 It is surrounded by hundreds of skeletons.
 These are the remains of ancient rites.
<blockquote>Eye Tyrant: Number-1 Attack-[1d6+2] Escape-[1d6+2] Hit-[1d6+5] Damage-[3d6] Endurance-[4d6] Life-[4d6] Charm-[2d6] Eyes-[2d6] Transmutation-[2d6]</blockquote>

# Newts are water salamanders; olms are cave salamanders. They all use the same name list.

;newt lair description
1,[newt hall]
[salamanders]
[newt activity]
[newt quote]

;newt hall
1,Warm waters fill these tunnels. Mist rises from the surface.
 The constant murmur of water falling and endless echoes fill the air.
 Orange light below the surface show humanoids with long tails moving about.
 Some of them have spears.
 This is a meeting ground of newts.
1,Ancient water-filled halls, domed arches, alcoves with orange light pointing up, reflections dancing on the water’s surface.
 Rows of columns support ceilings. Stairs rise up and lead to benches.
 This looks like an ancient cistern, bath or a flooded temple.
 Except that in the water below, newts are moving about.
1,Huge boulders lie here, and between the boulders, the water-filled cracks go deep.
 In the blackness below, pale creatures cling to the walls.
 These are olms. Cave salamanders with external gills.
 They don’t seem to be interested in coming up to the surface.

;newt activity
1,A group of newts stands around a boulder.
 On it stands a brazier filled with liquid orange light.
1,Some newts are standing in a stone circle.
 Drops of orange light float gently from monolith to monolith.
1,A few newts stand motionless, unblinking, staring over the water.
 The waves lapping at their feet dance an orange glow.

;newt quote
1,<blockquote>[@name] says: “Did you know that all these tunnels were once filled with water?
 Who drained them all?
 Who built the dams and drains that destroyed our world?
 It was the dwarves who dug and built their maggot hives.”</blockquote>
1,<blockquote>[@name] says: “We were the first to settle Myrkheim.
 We were here before the dwarves came.
 We will still be here when the dwarves are gone.
 This is our realm.”</blockquote>
1,<blockquote>[@name] says: “What is a newt?
 To have two legs to walk with makes us newts.
 To have two arms to work with makes us newts.
 To lay our eggs in the water were we once came from makes us newts.
 Who are you?”</blockquote>

;newt court name
1,The Ten Thousand Guardians
1,The Caverns of Silence
1,The Benthic Court
1,The Olm Court

;newt court
1,<h2 id="[@location]">[@[@location]]</h2>
<p>There is a lake at the bottom of a deep pit and within it beats a heart of light.[[realm]@to]
 If you look down from above it looks like [[@to] gate description].
 Tiny waterfalls drizzle into the abyss as the trail winds itself down, round and round, deeper and deeper.
<p>[[@to] throne description].
 Light spills into this world as if through a tear in the fabric of the realm.
 It is so unreal.
<p>This is the Olm Court.
 They stand below the water, in long rows, holding their spears.
 Their red gills forming fantastic neck wreaths.
 They are guarding their queen.
[olms]
<p>The power of Air is one of the talents one needs to master to gain <a href="#X">The Crown of Darkness</a>.
 Here is where you could learn it.
 This is also one of the places where you could leave Myrkheim on your own: The Olm Gate leads to [@to].
<p>From here, a tunnel lead to [[@location] neighbours].

;olms
1,<blockquote>[[salamander name]@name][@name] and her followers: [nightling] Healing-[2d6] Air-[2d6] Water-[2d6]</blockquote>

;realm
1,Muspelheim
1,Jötunheim
1,Vanaheim

;Muspelheim gate description
1,the eye of a fire dragon, like liquid fire

;Jötunheim gate description
1,the eye of an ice queen, like glacier light

;Vanaheim gate description
1,the green eye of a forest in spring, like leaves

;Muspelheim throne description
1,In the middle of the lake glows an orange throne, pulsating slowly, like the illuminated heart of a giant

;Jötunheim throne description
1,In the middle of the lake shines an iceberg throne, bright white at the top and brooding midnight down blow

;Vanaheim throne description
1,In the middle of the lake grows a tumor of wood, leaves, flowers, reeds, root, illuminated by glowing bugs and worms

;spider lair description
1,A dark cave that reeks of death. Bones cover the ground, they crack underfoot.
 In the center, a pedestal on which shines a golden ring.
 The spider drops from the ceiling, web stretched across its front legs, right on top of you.
[spider]
1,A long corridor littered with the chitin of dead fire beetles.
 The wolf spider waits above the entrance, ready to chase you down.
 You can’t outrun it, but a meal may slow it down long enough to reach safety.
[spider]
1,Bio-luminescent mushrooms cover the ceiling, a fascinating sight.
 The trapdoor spider pounces out of its burrow to catch the unwary.
 Once the prey has been brought in, the study woven door closes, nigh impossible to open from outside.
[spider]
1,A maze of tight squeezes. A single long thread of silk goes through: a spider’s lifeline.
 Does it lead to the exit, or to its owner?
[spider]
1,A bottomless sinkhole. Webbed parachutes of silk are suspended next to the entrance.
 What could await below?
[spiders]
1,A wide cavern crisscrossed with thin silk threads. They seem solid enough to be walked on.
 The non-sticky ones do not attract dust, they are barely visible.
[spiders]
1,A decaying spiderweb at an intersection. Inside, the giant spider’s corpse.
 Slight twitches: the parasitic wasp’s larvae are ready to burst out.
[larvae]
1,A web funnel spun on charred stone walls.
 Mummified victims are interspersed with silk sacks full of water for fire protection.
 This den won’t be burnt twice.
[spider]
1,A glacial chasm crossed by a cobweb covered in hoarfrost. It’s sturdy, but slippery.
 An open flame is enough to thaw the threads… And warn the ice tarantula that a prey has arrived.
[ice spider]
1,A water-filled cavity, too wide to be crossed in a single breath.
 Down below are water spiders hunting blind fish in these dark depths.
 They carry large air bubbles between their legs.
 They do not seem keen to share their oxygen tank.
[spiders]

;spiders
1,<blockquote>Spiders: [predator]</blockquote>

;spider
1,<blockquote>Spider: Number-1 Attack-[1d6+5] Escape-[1d6+2] Hit-[1d6+6] Damage-[2d6] Endurance-[3d6] Life-[2d6]</blockquote>

;ice spider
1,<blockquote>Ice [Spider|Tarantula|Hunter]: Number-1 Attack-[1d6+5] Escape-[1d6+2] Hit-[1d6+6] Damage-[2d6] Endurance-[3d6] Life-[2d6]; Ice-[2d6] to freeze the air, check Endurance to keep acting</blockquote>

;larvae
1,<blockquote>Larvae: Number-[3d6] Attack-[1d6+5] Escape-[1d6+2] Hit-[1d6+3] Damage-[1d4] Endurance-[1d6] Life-[1d6]</blockquote>

;spider city
1,<h2 id="[@location]">[@[@location]]</h2>
<p>Greyness filters down from above.
 The detritus of light sinks to the bottom every so slowly, reflected a thousand times by dew and spider silk.
 The hollow husk of dead smell is all that remains.
<p>The spiders that live in this skyhole are [Silver|Moon|Orb|Mirror|Glass|Ice] Phase Spiders.
 Way up, where the air is thin and the light is stronger, the boundaries between the realms starts flickering.
 The Phase Spiders have attuned to this. This is how they manage to cross over into other realms.
 It is what gives them their name.
[phase spiders]
<p>The power of Planeswalk is one of the talents one needs to master to gain <a href="#X">The Crown of Darkness</a>.
 Here is where you could learn it.
 This is also one of the places where you could leave Myrkheim on your own: by climbing this shaft for two weeks you can reach [Midgard|Vanaheim].
<p>From here, a tunnel lead to [[@location] neighbours].

;phase spiders
1,<blockquote>[phase spider name] and her followers: [predator] Eyes-[2d6] Planeswalk-[2d6] Spying-[2d6]</blockquote>

;phase spider name
1,Ettūtu the Spider
1,Būnzerru the Hidden
1,Anzūzu the Wise
1,Ḫadālu the Tier of Knots
1,Lummû the Dissolver
1,Qû the Weaver
1,Šatû the Entangler
1,Tūya the Weaver

;myrkheim crown name
1,The Oldest Grave
1,The Black Pool of Pain
1,The Waterfall of a Thousand Tears
1,The Graveyard of Leviathans
1,The Curse of the Old One

;myrkheim crown
1,<h2 id="[@location]">[@[@location]]</h2>
<p>Beneath the Waterfall of a Thousand Tears lies the Black Pool of Pain.
 Down there is the water-filled Cavern of Bones.
 How these leviathans came here to die, nobody knows.
 In this benthic graveyard, with all the bulk of Myrkheim above you, the boundaries between the realms is weakened.
 Gravity flickers.
 The void groans.
<p>If you managed to bring your own air into the deep, you’ll see the fickle slivers of the phase transition.
 If you know the secret of planeswalking, you can stabilize the gate.
 If you have a ghoul mind, you can make the transition into the Grave of Nagabbiš.
<p>Here sleeps the Old Master of Myrkheim.
 Here lies his crown, Agê Uzzu, the Crown of Wrath.
 Take it and rule Myrkheim.
<blockquote>The prerequisites:
 Master <a href="#T">Air</a>.
 Master <a href="#V">Planeswalk</a>.
 Master <a href="#W">Necromancy</a>.</blockquote>
<p>A tunnels leads back to [[@location] neighbours].

# girtablilu = scorpion men

# Local Variables:
# sgml-basic-offset: 0
# End:
</script>
</body>
</html>
